<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="messageMapper">
  	<resultMap type="Message" id="messageResultSet">
  		<id property="mId" column="MID"/>
  		<result property="mSender" column="SENDER"/>
  		<result property="mReceiver" column="RECEIVER"/>
  		<result property="mContent" column="MCONTENT"/>
  		<result property="mDate" column="MDATE"/>
  		<result property="mRead" column="MREAD"/>
  		<result property="mStatus" column="MDEL_YN"/>
  	</resultMap>
  	
  	<resultMap id="friendResultSet" type="FriendList">
		<id property="msgMyId" column="MSGMYID"/>
		<result property="msgFriendName" column="MSGFRIENDNAME"/>
		<result property="msgFollowingNum" column="MSGFOLLOWINGNUM"/>
		<result property="msgFollowerNum" column="MSGFOLLOWERNUM"/>
		<result property="msgFriendCategory" column="MSGFRIENDCATEGORY"/>
		
	</resultMap>
  	
  	<!-- 메시지 리스트 가져오기 -->
  	<select id="msgList" resultMap="messageResultSet">
  		SELECT *
  		FROM MESSAGE
  		WHERE MDEL_YN = 'N'
  		OREDER BY MID DESC
  	</select>
  	
  	
  	<!-- 메시지 친구 리스트 가져오기 -->
  	<select id="msgFriendList" resultMap="friendResultSet">
  		SELECT F.HOST AS MSGMYID, NICKNAME AS MSGFRIENDNAME,
		(SELECT COUNT(*)FROM FOLLOW WHERE HOST = F.FOLLOWER) AS MSGFOLLOWINGNUM,
		(SELECT COUNT(*) FROM FOLLOW WHERE FOLLOWER = F.FOLLOWER) AS MSGFOLLOWERNUM,
		 P.INTEREST MSGFRIENDCATEGORY
		FROM MEMBER M
		JOIN FOLLOW F ON (M.USERID = F.FOLLOWER)
		JOIN MYPAGE P ON (F.FOLLOWER = P.USERID)
		WHERE F.HOST = #{userId}
  	</select>
  	
  </mapper>