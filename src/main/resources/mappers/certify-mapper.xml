<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="certifyMapper">

	<!-- resultMap -->
	<resultMap type="Certify" id="certifyResultSet">
		<id property="ceId" column="CEID"/>
		<result property="chId" column="CHID"/>
		<result property="userId" column="USERID"/>
		<result property="ceContent" column="CECONTENT"/>
		<result property="cePicture" column="CEPICTURE"/>
		<result property="ceDate" column="CEDATE"/>
		<result property="ceDel" column="CEDEL_YN"/>
	</resultMap>
	<!-- 인증글 갯수 -->
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*)
		FROM CERTIFY
		WHERE CEDEL_YN='N'
	</select>
	<!-- 인증글 리스트 출력 -->
	<select id="selectList" resultMap="certifyResultSet">
		SELECT C.CHNAME, C.STARTDATE, C.ENDDATE,R.*
		FROM CHALLENGE C
		JOIN CERTIFY R
		ON C.CHID = R.CHID
        ORDER BY CEID ASC
	</select>
	<!-- 인증글 상세보기 -->
	<select id="selectCertify" resultMap="certifyResultSet">
		SELECT * FROM CERTIFY
		WHERE CEID = #{ceId}
		AND CEDEL_YN='N'
	</select>
	<!-- 인증글 검색 갯수 -->
	<select id="getSearchListCount" parameterType="SearchCondition" resultType="_int">
		SELECT COUNT(*)
		FROM CERTIFY
		WHERE CEDEL_YN = 'N'
		
		<if test="title != null">
			AND CECONTENT LIKE '%' || #{title} || '%'
		</if>
		<if test="writer != null">
			AND USERID LIKE '%' || #{writer} || '%'
		</if>
	</select>
	<select id="selectSearchList" resultMap="certifyResultSet">
		SELECT C.CHNAME, C.STARTDATE, C.ENDDATE,R.*
		FROM CHALLENGE C
		JOIN CERTIFY R
		ON C.CHID = R.CHID 		
  		<if test="title != null">
			AND CHNAME LIKE '%' || #{title} || '%'
		</if>
		<if test="writer != null">
			AND R.USERID LIKE '%' || #{writer} || '%'
		</if>
		ORDER BY CEID ASC 	
	</select>
	
	<update id="updateCertify" parameterType="_int">
	UPDATE CERTIFY SET 
	CEDEL_YN = 'Y' 
	WHERE CEID = #{ceId}
	</update>


</mapper>